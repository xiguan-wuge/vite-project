var k=Object.defineProperty;var M=(e,t,o)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var l=(e,t,o)=>(M(e,typeof t!="symbol"?t+"":t,o),o);import{q as W,d as C,r as B,c as D,b as c,h as v,u as x,a as F}from"./index.1b73f85f.js";import{_ as T}from"./plugin-vue_export-helper.21dcd24c.js";class S{constructor(t){l(this,"textArr",["test","\u81EA\u5B9A\u4E49\u6C34\u5370"]);l(this,"font",'16px "\u5FAE\u8F6F\u96C5\u9ED1"');l(this,"fillStyle","rgba(170,170,170,0.4)");l(this,"maxWidth",200);l(this,"minWidth",120);l(this,"lineHeight",24);l(this,"deg",-45);l(this,"marginRight",0);l(this,"marginBottom",0);l(this,"left",20);l(this,"top",20);l(this,"opacity",".75");l(this,"position","absolute");t&&Object.assign(this,t)}}function $(){const e=document.createElement("canvas");return e.style.display="none",e}function I(e,t){const o=e.getContext("2d"),n=t.textArr||[];let r=[];const s=[];n.forEach(h=>{const d=O(o,h+"",t.maxWidth,t.font);console.log("result",d),r=r.concat(d.textArr),s.push(d.maxWidth)}),console.log("wordBreakTextArr",r),console.log("maxWidthArr",s),s.sort((h,d)=>d-h);const a=Math.max(s[0],u.minWidth),i=t.lineHeight,m=r.length*i,f=Math.PI*t.deg/180,p=Math.abs(f),A=m*Math.sin(p),E=m*Math.cos(p),b=a*Math.sin(p),_=a*Math.cos(p);e.width=parseInt(A+_+t.marginRight+"",10),e.height=parseInt(b+E+t.marginBottom+"",10),o.font=t.font,o.fillStyle=t.fillStyle,o.textBaseline="hanging",o.translate(0,b),o.rotate(f),r.forEach((h,d)=>{o.fillText(h,0,i*d)})}function O(e,t,o,n){const r=[];let s=0;n&&(e.font=n);let a=w(t,o,e);for(;a!==-1;)r.push(t.substring(0,a)),t=t.substring(a),s=o,a=w(t,o,e);if(t){r.push(t);const i=e.measureText(t).width;s=s!==0?s:i}return{textArr:r,maxWidth:s}}function w(e,t,o){let n=0,r=e.length-1;for(;n<=r;){const s=Math.floor((n+r)/2),a=o.measureText(e.substring(0,s)).width,i=o.measureText(e.substring(0,s+1)).width;if(a<=t&&i>t)return s;a<t?n=s+1:r=s-1}return-1}let u=new S;const j=function(e,t){console.log("waterMask",t.value),u=Object.assign({},u,t.value||{}),console.log("defaultSettings",u),u.minWidth=Math.min(u.maxWidth,u.minWidth);const o=u.textArr;if(!Array.isArray(o))throw Error("\u6C34\u5370\u6587\u672C\u5FC5\u987B\u653E\u5728\u6570\u7EC4\u4E2D\uFF01");const n=$();I(n,u),H(n,e)};function H(e,t){if(!t)console.error("\u8BF7\u7ED1\u5B9A\u6E32\u67D3\u5BB9\u5668");else{const{parentElement:o}=t;console.log("el",t,o),t.getBoundingClientRect(),console.log("w",t.clientWidth,t.clientHeight);const n=document.createElement("div");t.setAttribute("style","position: relative;");const r=e.toDataURL("image/png");console.log("imgData",r),console.log("defaultSettings",u);const s=`
    width: ${t.clientWidth}px;
    height: ${t.clientHeight}px;
    position: ${u.position}; 
    left:0; 
    top:0; 
    right:0; 
    bottom:0; 
    pointer-events:none;opacity:${u.opacity};
    background-image: url('${r}');
    background-repeat: repeat;
    background-position: ${u.left}px ${u.top}px;
    `;n.style.cssText=s,o.setAttribute("style","position: relative;"),o.appendChild(n)}}const L={beforeMount(e,t){},mounted(e,t){j(e,t),W(()=>{})},beforeUnmount(){}};let g=`
display: block;
overflow: hidden;
position: absolute;
left: 0;
top: 0;
width: 100%;
height: 100%;
background-repeat: repeat;
pointer-events: none;`;const P=({font:e="16px normal",fillStyle:t="rgba(180, 180, 180, 0.3)",textAlign:o,textBaseline:n,text:r="\u8BF7\u52FF\u5916\u4F20"})=>{const a=document.createElement("canvas"),i=a.getContext("2d");return i.rotate(-20*Math.PI/180),i.font=e,i.fillStyle=t,i.textAlign=o||"left",i.textBaseline=n||"middle",i.fillText(r,a.width/3,a.height/2),a.toDataURL("image/png")},R=(e,t={})=>{const{parentElement:o}=e,n=P(t),r=document.createElement("div");r.className="water-mark",g=`${g}background-image: url(${n});`,r.setAttribute("style",g),o.setAttribute("style","position: relative;"),o.appendChild(r)},U=(e,t)=>{const o=e.parentElement.querySelector(".water-mark"),n=new MutationObserver(r=>{if(r.length){const{removedNodes:s,type:a,target:i}=r[0],m=o.getAttribute("style");s[0]===o?(n.disconnect(),y(e,t)):a==="attributes"&&i===o&&m!==g&&o.setAttribute("style",g)}});n.observe(e.parentElement,{childList:!0,attributes:!0,subtree:!0})},y=(e,t={})=>{R(e,t.value),U(e,t.value)},N={mounted(e,t){e.onload=y.bind(null,e,t)}};const q={class:"container"},V={class:"img-wraper"},z={src:"https://img2.woyaogexing.com/2023/03/12/d3fb4d961ea7f01e70b345f88e919050.jpg",alt:""},G={class:"img-wraper"},J={src:"https://img2.woyaogexing.com/2023/03/12/d3fb4d961ea7f01e70b345f88e919050.jpg",alt:""},K=C({__name:"demo",setup(e){const t=B({textArr:["\u8DEF\u706F\u4E0B\u7684\u5149","2023/04/14","\u5C55\u793A\u989D\u5916\u7684\u6587\u672CLOL\u54E6\u54AF"],deg:-35});return(o,n)=>(F(),D("div",q,[c("div",V,[v(c("img",z,null,512),[[x(L),t,"options"]])]),n[0]||(n[0]=c("hr",null,null,-1)),c("div",G,[v(c("img",J,null,512),[[x(N),"\u5F20\u4E09hhhhhhhhh"]])]),n[1]||(n[1]=c("div",null,[c("img",{class:"demo2",src:"https://img2.woyaogexing.com/2023/03/12/d3fb4d961ea7f01e70b345f88e919050.jpg",alt:""})],-1)),n[2]||(n[2]=c("div",{class:"demo2"},null,-1))]))}});var Z=T(K,[["__scopeId","data-v-6485bfd7"]]);export{Z as default};
