var M=Object.defineProperty;var W=(e,t,o)=>t in e?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var c=(e,t,o)=>(W(e,typeof t!="symbol"?t+"":t,o),o);import{y as C,d as B,r as D,a as F,c as S,b as u,h as _,u as w,p as T,f as I}from"./index.2e50bfa5.js";import{_ as $}from"./plugin-vue_export-helper.21dcd24c.js";class O{constructor(t){c(this,"textArr",["test","\u81EA\u5B9A\u4E49\u6C34\u5370"]);c(this,"font",'16px "\u5FAE\u8F6F\u96C5\u9ED1"');c(this,"fillStyle","rgba(170,170,170,0.4)");c(this,"maxWidth",200);c(this,"minWidth",120);c(this,"lineHeight",24);c(this,"deg",-45);c(this,"marginRight",0);c(this,"marginBottom",0);c(this,"left",20);c(this,"top",20);c(this,"opacity",".75");c(this,"position","absolute");t&&Object.assign(this,t)}}function j(){const e=document.createElement("canvas");return e.style.display="none",e}function H(e,t){const o=e.getContext("2d"),a=t.textArr||[];let n=[];const i=[];a.forEach(h=>{const d=L(o,h+"",t.maxWidth,t.font);console.log("result",d),n=n.concat(d.textArr),i.push(d.maxWidth)}),console.log("wordBreakTextArr",n),console.log("maxWidthArr",i),i.sort((h,d)=>d-h);const s=Math.max(i[0],l.minWidth),r=t.lineHeight,m=n.length*r,b=Math.PI*t.deg/180,p=Math.abs(b),k=m*Math.sin(p),A=m*Math.cos(p),v=s*Math.sin(p),E=s*Math.cos(p);e.width=parseInt(k+E+t.marginRight+"",10),e.height=parseInt(v+A+t.marginBottom+"",10),o.font=t.font,o.fillStyle=t.fillStyle,o.textBaseline="hanging",o.translate(0,v),o.rotate(b),n.forEach((h,d)=>{o.fillText(h,0,r*d)})}function L(e,t,o,a){const n=[];let i=0;a&&(e.font=a);let s=x(t,o,e);for(;s!==-1;)n.push(t.substring(0,s)),t=t.substring(s),i=o,s=x(t,o,e);if(t){n.push(t);const r=e.measureText(t).width;i=i!==0?i:r}return{textArr:n,maxWidth:i}}function x(e,t,o){let a=0,n=e.length-1;for(;a<=n;){const i=Math.floor((a+n)/2),s=o.measureText(e.substring(0,i)).width,r=o.measureText(e.substring(0,i+1)).width;if(s<=t&&r>t)return i;s<t?a=i+1:n=i-1}return-1}let l=new O;const P=function(e,t){console.log("waterMask",t.value),l=Object.assign({},l,t.value||{}),console.log("defaultSettings",l),l.minWidth=Math.min(l.maxWidth,l.minWidth);const o=l.textArr;if(!Array.isArray(o))throw Error("\u6C34\u5370\u6587\u672C\u5FC5\u987B\u653E\u5728\u6570\u7EC4\u4E2D\uFF01");const a=j();H(a,l),R(a,e)};function R(e,t){if(!t)console.error("\u8BF7\u7ED1\u5B9A\u6E32\u67D3\u5BB9\u5668");else{const{parentElement:o}=t;console.log("el",t,o),t.getBoundingClientRect(),console.log("w",t.clientWidth,t.clientHeight);const a=document.createElement("div");t.setAttribute("style","position: relative;");const n=e.toDataURL("image/png");console.log("imgData",n),console.log("defaultSettings",l);const i=`
    width: ${t.clientWidth}px;
    height: ${t.clientHeight}px;
    position: ${l.position}; 
    left:0; 
    top:0; 
    right:0; 
    bottom:0; 
    pointer-events:none;opacity:${l.opacity};
    background-image: url('${n}');
    background-repeat: repeat;
    background-position: ${l.left}px ${l.top}px;
    `;a.style.cssText=i,o.setAttribute("style","position: relative;"),o.appendChild(a)}}const z={beforeMount(e,t){},mounted(e,t){P(e,t),C(()=>{})},beforeUnmount(){}};let g=`
display: block;
overflow: hidden;
position: absolute;
left: 0;
top: 0;
width: 100%;
height: 100%;
background-repeat: repeat;
pointer-events: none;`;const U=({font:e="16px normal",fillStyle:t="rgba(180, 180, 180, 0.3)",textAlign:o,textBaseline:a,text:n="\u8BF7\u52FF\u5916\u4F20"})=>{const s=document.createElement("canvas"),r=s.getContext("2d");return r.rotate(-20*Math.PI/180),r.font=e,r.fillStyle=t,r.textAlign=o||"left",r.textBaseline=a||"middle",r.fillText(n,s.width/3,s.height/2),s.toDataURL("image/png")},N=(e,t={})=>{const{parentElement:o}=e,a=U(t),n=document.createElement("div");n.className="water-mark",g=`${g}background-image: url(${a});`,n.setAttribute("style",g),o.setAttribute("style","position: relative;"),o.appendChild(n)},q=(e,t)=>{const o=e.parentElement.querySelector(".water-mark"),a=new MutationObserver(n=>{if(n.length){const{removedNodes:i,type:s,target:r}=n[0],m=o.getAttribute("style");i[0]===o?(a.disconnect(),y(e,t)):s==="attributes"&&r===o&&m!==g&&o.setAttribute("style",g)}});a.observe(e.parentElement,{childList:!0,attributes:!0,subtree:!0})},y=(e,t={})=>{N(e,t.value),q(e,t.value)},V={mounted(e,t){e.onload=y.bind(null,e,t)}};const f=e=>(T("data-v-6485bfd7"),e=e(),I(),e),G={class:"container"},J={class:"img-wraper"},K={src:"https://img2.woyaogexing.com/2023/03/12/d3fb4d961ea7f01e70b345f88e919050.jpg",alt:""},Q=f(()=>u("hr",null,null,-1)),X={class:"img-wraper"},Y={src:"https://img2.woyaogexing.com/2023/03/12/d3fb4d961ea7f01e70b345f88e919050.jpg",alt:""},Z=f(()=>u("div",null,[u("img",{class:"demo2",src:"https://img2.woyaogexing.com/2023/03/12/d3fb4d961ea7f01e70b345f88e919050.jpg",alt:""})],-1)),tt=f(()=>u("div",{class:"demo2"},null,-1)),et=B({__name:"demo",setup(e){const t=D({textArr:["\u8DEF\u706F\u4E0B\u7684\u5149","2023/04/14","\u5C55\u793A\u989D\u5916\u7684\u6587\u672CLOL\u54E6\u54AF"],deg:-35});return(o,a)=>(F(),S("div",G,[u("div",J,[_(u("img",K,null,512),[[w(z),t,"options"]])]),Q,u("div",X,[_(u("img",Y,null,512),[[w(V),"\u5F20\u4E09hhhhhhhhh"]])]),Z,tt]))}});var it=$(et,[["__scopeId","data-v-6485bfd7"]]);export{it as default};
